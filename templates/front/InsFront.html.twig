{% extends 'front/index.html.twig' %}

{% block main %}
    <main>
        <section class="breadcrumb__area background-bg pt-180 pb-180 include-bg p-relative fix"
                 data-background="assets/img/breadcurmb/breadcurmb.jpg">
            <div class="tp-breadcrmb-circle-one"></div>
            <div class="tp-breadcrmb-circle-two"></div>
            <div class="container">
                <div class="row">
                    <div class="col-xxl-12">
                        <div class="breadcrumb__wrapper z-index-6 d-flex justify-content-between align-items-center">
                            <div class="breadcrumb__content">
                                <h3 class="breadcrumb__title">Insurances</h3>
                            </div>
                            <div class="breadcrumb__button">
                                <a class="tp-btn-white" href="contact.html">Contact us today<i
                                            class="far fa-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="tp-case-area pt-130 pb-90">
        <div class="container">
         <div class="row align-items-end service-bottom-space">
            <div class="col-xl-6 col-lg-6 col-12">
               <div class="sercviceinsurance__title service-border-right service-details-border">
                  <h3 class="tp-section-title">Revolutionizing <br> the insurance</h3>
               </div>
            </div>
            <div class="col-xl-6 col-lg-6 col-12">
               <div class="tp-service-right-text">
                  <p>
Welcome to our comprehensive insurance coverage hub, where peace of mind meets protection. At Insuria, we understand that life is full of uncertainties, which is why we're dedicated to providing tailored insurance solutions to safeguard what matters most to you.</p>
               </div>
            </div>
         </div>
         </div>
            <div class="container">
                <div class="row">
                   <div class="sorting-buttons">
    <button id="sortHighToLow" class="btn btn-primary btn-lg">
        <i class="fas fa-arrow-up"></i> <!-- Up arrow icon -->
    </button>
    <button id="sortLowToHigh" class="btn btn-primary btn-lg">
        <i class="fas fa-arrow-down"></i> <!-- Down arrow icon -->
    </button>
</div>
                    <div class="col-xl-12 text-center mb-50">
                     
                        <div class="tp-case-tab-button masonary-menu">
                            <button class="active" data-filter="*"><span>All</span></button>
                            {% for category in categories %}
                                <button data-filter="{{ category.id }}"><span>{{ category.namecatins }}</span></button>
                            {% endfor %}
                        </div>
    
                </div>
                </div>
                    
                <div class="row" id="assuranceContainer">
                    {% if assurances is not empty %}
                        {% for assurance in assurances %}
                           <div class="col-xl-4 col-lg-6 assurance-item" data-category="{{ assurance.catA.id }}">
                                <div class="tpcaseitem mb-30">
                                    <div class="tpcaseitem__thumb fix">
                                        {% if assurance.insImage %}
                                            <a href="{{ path('add_com', {'id': assurance.id}) }}">
                                                <img src="{{ asset('uploads/images/' ~ assurance.insImage) }}" alt="" style="width: 482px; height: 388px;">
                                            </a>
                                        {% else %}
                                            <a href="{{ path('add_com', {'id': assurance.id}) }}">
                                                <img src="/path/to/placeholder/image.jpg" alt="No Image">
                                            </a>
                                        {% endif %}
                                    </div>
                                    <div class="tpcaseitem__content">
                                        <div class="tpcase-info p-relative">
                                            <!-- Insurance name wrapped in its own HTML element -->
                                            <h3 class="tp-case-title">
                                                <a href="{{ path('add_com', {'id': assurance.id}) }}">{{ assurance.nameins }}</a>
                                            </h3>
                                            <h4 class="tp-case-title">Starting Price: {{ assurance.montant }} DT</h4>
                                            <div class="tp-case-icon">
                                                <a href="#"><i class="fal fa-arrow-right"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>No assurances found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
       


    </main>
  
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryButtons = document.querySelectorAll('.tp-case-tab-button button');
    const assuranceContainer = document.getElementById('assuranceContainer');
    const sortHighToLowButton = document.getElementById('sortHighToLow');
    const sortLowToHighButton = document.getElementById('sortLowToHigh');

    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.getAttribute('data-filter');
            
            filterAssurances(category);
        });
    });

    sortHighToLowButton.addEventListener('click', function() {
        filterPrices('high_to_low');
    });

    sortLowToHighButton.addEventListener('click', function() {
        filterPrices('low_to_high');
    });
    




    function filterAssurances(category) {
        console.log(category);
        fetch('/filter-assurances/' + encodeURIComponent(category), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
        .then(response => response.json())
        .then(data => {
          
            assuranceContainer.innerHTML = ''; // Clear previous content

            data.forEach(data => { // Change 'assurance' to 'data'
                const assuranceItem = document.createElement('div');
                assuranceItem.classList.add('col-xl-4', 'col-lg-6', 'assurance-item');
                assuranceItem.setAttribute('data-category', data.catA); // Change 'assurance' to 'data'
                const assetPath = "{{ asset('uploads/images/' ~ 'dummy') }}".replace('dummy', `${data.insImage}`);
              
                assuranceItem.innerHTML = `
                    <div class="tpcaseitem mb-30">
                        <div class="tpcaseitem__thumb fix">
                            <a href="#">
                                <img src="${assetPath}" alt="" style="width: 482px; height: 388px;">
                            </a>
                        </div>
                        <div class="tpcaseitem__content">
                            <div class="tpcase-info p-relative">
                                <h3 class="tp-case-title">
                                    <a href="#">`+ data.nameins +`</a>
                                </h3>
                                <h4 class="tp-case-title">Starting Price: `+ data.montant +` DT</h4>
                                <div class="tp-case-icon">
                                    <a href="#"><i class="fal fa-arrow-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>`;

                assuranceContainer.appendChild(assuranceItem);
            });
        })
        .catch(error => console.error('Error:', error));
    }





    function filterPrices(sortingOption) {
    console.log('Filtering prices with sorting option:', sortingOption);
    fetch('{{ path('filter_prices') }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ sortingOption: sortingOption }) // Ensure sortingOption is included in the JSON body
    })
        .then(response => response.json())
        .then(data => {
            console.log('Sorted assurance data:', data);
            assuranceContainer.innerHTML = ''; // Clear previous content

            data.forEach(data => { // Change 'assurance' to 'data'
            
                const assuranceItem = document.createElement('div');
                console.log(assuranceItem);
                assuranceItem.classList.add('col-xl-4', 'col-lg-6', 'assurance-item');
                assuranceItem.setAttribute('data-category', data.catA); // Change 'assurance' to 'data'

                const assetPath = "{{ asset('uploads/images/' ~ 'dummy') }}".replace('dummy', `${data.insImage}`);
               
                assuranceItem.innerHTML = `
                    <div class="tpcaseitem mb-30">
                        <div class="tpcaseitem__thumb fix">
                            <a href="#">
                                <img src="${assetPath}" alt="" style="width: 482px; height: 388px;">
                            </a>
                        </div>
                        <div class="tpcaseitem__content">
                            <div class="tpcase-info p-relative">
                                <h3 class="tp-case-title">
                                    <a href="#">`+ data.nameins +`</a>
                                </h3>
                                <h4 class="tp-case-title">Starting Price: `+ data.montant +` DT</h4>
                                <div class="tp-case-icon">
                                    <a href="#"><i class="fal fa-arrow-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>`;

                assuranceContainer.appendChild(assuranceItem);
            });
        })
        .catch(error => console.error('Error:', error));
    }
});

</script>

  {% endblock %}
